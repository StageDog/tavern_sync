{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "type": "object",
  "properties": {
    "anchors": {
      "description": "用于存放 YAML 锚点, 不会被实际使用"
    },
    "entries": {
      "type": "array",
      "items": {
        "anyOf": [
          {
            "type": "object",
            "properties": {
              "name": {
                "type": "string"
              },
              "uid": {
                "description": "该条目的唯一标识符, 如果不设置或有重复则会自动分配一个新的",
                "type": "number"
              },
              "enabled": {
                "type": "boolean"
              },
              "strategy": {
                "description": "激活策略: 条目应该何时激活",
                "type": "object",
                "properties": {
                  "type": {
                    "description": "激活策略类型:\n- constant: 常量🔵, 俗称蓝灯. 只需要满足 \"启用\"、\"激活概率%\" 等别的要求即可.\n- selective: 可选项🟢, 俗称绿灯. 除了蓝灯条件, 还需要满足 `keys` 扫描条件\n- vectorized: 向量化🔗. 一般不使用",
                    "type": "string",
                    "enum": [
                      "constant",
                      "selective",
                      "vectorized"
                    ]
                  },
                  "keys": {
                    "description": "关键字: 绿灯条目必须在欲扫描文本中扫描到其中任意一个关键字才能激活",
                    "minItems": 1,
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  },
                  "keys_secondary": {
                    "description": "次要关键字: 如果设置了次要关键字, 则条目除了在 `keys` 中匹配到任意一个关键字外, 还需要按次要关键字的 `logic` 满足次要关键字的 `keys`",
                    "type": "object",
                    "properties": {
                      "logic": {
                        "description": "次要关键字逻辑:\n- and_any: 次要关键字中任意一个关键字能在欲扫描文本中匹配到\n- and_all: 次要关键字中所有关键字都能在欲扫描文本中匹配到\n- not_all: 次要关键字中至少有一个关键字没能在欲扫描文本中匹配到\n- not_any: 次要关键字中所有关键字都没能欲扫描文本中匹配到",
                        "type": "string",
                        "enum": [
                          "and_any",
                          "and_all",
                          "not_all",
                          "not_any"
                        ]
                      },
                      "keys": {
                        "minItems": 1,
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      }
                    },
                    "required": [
                      "logic",
                      "keys"
                    ],
                    "additionalProperties": false
                  },
                  "scan_depth": {
                    "description": "扫描深度: 1 为仅扫描最后一个楼层, 2 为扫描最后两个楼层, 以此类推",
                    "anyOf": [
                      {
                        "type": "string",
                        "const": "same_as_global"
                      },
                      {
                        "type": "number",
                        "minimum": 1
                      }
                    ]
                  }
                },
                "required": [
                  "type"
                ],
                "additionalProperties": false
              },
              "position": {
                "type": "object",
                "properties": {
                  "type": {
                    "description": "插入位置类型:\n- before_character_definition: 角色定义之前\n- after_character_definition: 角色定义之后\n- before_example_messages: 示例消息之前\n- after_example_messages: 示例消息之后\n- before_author_note: 作者注释之前\n- after_author_note: 作者注释之后\n- at_depth: 插入到指定深度",
                    "type": "string",
                    "enum": [
                      "before_character_definition",
                      "after_character_definition",
                      "before_example_messages",
                      "after_example_messages",
                      "before_author_note",
                      "after_author_note",
                      "at_depth"
                    ]
                  },
                  "role": {
                    "description": "该条目的消息身份, 仅位置类型为 `'at_depth'` 时有效",
                    "type": "string",
                    "enum": [
                      "system",
                      "assistant",
                      "user"
                    ]
                  },
                  "depth": {
                    "description": "该条目要插入的深度, 仅位置类型为 `'at_depth'` 时有效",
                    "type": "number"
                  },
                  "order": {
                    "type": "number"
                  }
                },
                "required": [
                  "type",
                  "order"
                ],
                "additionalProperties": false
              },
              "probability": {
                "type": "number",
                "minimum": 0,
                "maximum": 100
              },
              "recursion": {
                "description": "递归表示某世界书条目被激活后, 该条目的提示词又激活了其他条目",
                "type": "object",
                "properties": {
                  "prevent_incoming": {
                    "description": "禁止其他条目递归激活本条目",
                    "type": "boolean"
                  },
                  "prevent_outgoing": {
                    "description": "禁止本条目递归激活其他条目",
                    "type": "boolean"
                  },
                  "delay_until": {
                    "description": "延迟到第 n 级递归检查时才能激活本条目",
                    "anyOf": [
                      {
                        "type": "number",
                        "minimum": 1
                      },
                      {
                        "type": "null"
                      }
                    ]
                  }
                },
                "additionalProperties": false
              },
              "effect": {
                "type": "object",
                "properties": {
                  "sticky": {
                    "description": "黏性: 条目激活后, 在之后 n 条消息内始终激活, 无视激活策略、激活概率%",
                    "anyOf": [
                      {
                        "type": "number",
                        "minimum": 1
                      },
                      {
                        "type": "null"
                      }
                    ]
                  },
                  "cooldown": {
                    "description": "冷却: 条目激活后, 在之后 n 条消息内不能再激活",
                    "anyOf": [
                      {
                        "type": "number",
                        "minimum": 1
                      },
                      {
                        "type": "null"
                      }
                    ]
                  },
                  "delay": {
                    "description": "延迟: 聊天中至少有 n 楼消息时, 才能激活条目",
                    "anyOf": [
                      {
                        "type": "number",
                        "minimum": 1
                      },
                      {
                        "type": "null"
                      }
                    ]
                  }
                },
                "additionalProperties": false
              },
              "group": {
                "description": "包含组",
                "type": "object",
                "properties": {
                  "labels": {
                    "description": "组标签",
                    "minItems": 1,
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  },
                  "use_priority": {
                    "description": "使用优先级",
                    "default": false,
                    "type": "boolean"
                  },
                  "weight": {
                    "description": "权重",
                    "default": 100,
                    "type": "number"
                  },
                  "use_scoring": {
                    "description": "使用评分",
                    "default": "same_as_global",
                    "anyOf": [
                      {
                        "type": "boolean"
                      },
                      {
                        "type": "string",
                        "const": "same_as_global"
                      }
                    ]
                  }
                },
                "additionalProperties": false
              },
              "extra": {
                "description": "额外字段: 用于为预设提示词绑定额外数据",
                "type": "object",
                "propertyNames": {
                  "type": "string"
                },
                "additionalProperties": {}
              },
              "content": {
                "description": "内嵌的提示词内容",
                "type": "string"
              },
              "file": {
                "description": "外链的提示词文件路径",
                "type": "string"
              }
            },
            "required": [
              "name",
              "enabled",
              "strategy",
              "position"
            ],
            "additionalProperties": false
          },
          {
            "type": "object",
            "properties": {
              "folder": {
                "type": "string"
              },
              "entries": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "name": {
                      "type": "string"
                    },
                    "uid": {
                      "description": "该条目的唯一标识符, 如果不设置或有重复则会自动分配一个新的",
                      "type": "number"
                    },
                    "enabled": {
                      "type": "boolean"
                    },
                    "strategy": {
                      "description": "激活策略: 条目应该何时激活",
                      "type": "object",
                      "properties": {
                        "type": {
                          "description": "激活策略类型:\n- constant: 常量🔵, 俗称蓝灯. 只需要满足 \"启用\"、\"激活概率%\" 等别的要求即可.\n- selective: 可选项🟢, 俗称绿灯. 除了蓝灯条件, 还需要满足 `keys` 扫描条件\n- vectorized: 向量化🔗. 一般不使用",
                          "type": "string",
                          "enum": [
                            "constant",
                            "selective",
                            "vectorized"
                          ]
                        },
                        "keys": {
                          "description": "关键字: 绿灯条目必须在欲扫描文本中扫描到其中任意一个关键字才能激活",
                          "minItems": 1,
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        },
                        "keys_secondary": {
                          "description": "次要关键字: 如果设置了次要关键字, 则条目除了在 `keys` 中匹配到任意一个关键字外, 还需要按次要关键字的 `logic` 满足次要关键字的 `keys`",
                          "type": "object",
                          "properties": {
                            "logic": {
                              "description": "次要关键字逻辑:\n- and_any: 次要关键字中任意一个关键字能在欲扫描文本中匹配到\n- and_all: 次要关键字中所有关键字都能在欲扫描文本中匹配到\n- not_all: 次要关键字中至少有一个关键字没能在欲扫描文本中匹配到\n- not_any: 次要关键字中所有关键字都没能欲扫描文本中匹配到",
                              "type": "string",
                              "enum": [
                                "and_any",
                                "and_all",
                                "not_all",
                                "not_any"
                              ]
                            },
                            "keys": {
                              "minItems": 1,
                              "type": "array",
                              "items": {
                                "type": "string"
                              }
                            }
                          },
                          "required": [
                            "logic",
                            "keys"
                          ],
                          "additionalProperties": false
                        },
                        "scan_depth": {
                          "description": "扫描深度: 1 为仅扫描最后一个楼层, 2 为扫描最后两个楼层, 以此类推",
                          "anyOf": [
                            {
                              "type": "string",
                              "const": "same_as_global"
                            },
                            {
                              "type": "number",
                              "minimum": 1
                            }
                          ]
                        }
                      },
                      "required": [
                        "type"
                      ],
                      "additionalProperties": false
                    },
                    "position": {
                      "type": "object",
                      "properties": {
                        "type": {
                          "description": "插入位置类型:\n- before_character_definition: 角色定义之前\n- after_character_definition: 角色定义之后\n- before_example_messages: 示例消息之前\n- after_example_messages: 示例消息之后\n- before_author_note: 作者注释之前\n- after_author_note: 作者注释之后\n- at_depth: 插入到指定深度",
                          "type": "string",
                          "enum": [
                            "before_character_definition",
                            "after_character_definition",
                            "before_example_messages",
                            "after_example_messages",
                            "before_author_note",
                            "after_author_note",
                            "at_depth"
                          ]
                        },
                        "role": {
                          "description": "该条目的消息身份, 仅位置类型为 `'at_depth'` 时有效",
                          "type": "string",
                          "enum": [
                            "system",
                            "assistant",
                            "user"
                          ]
                        },
                        "depth": {
                          "description": "该条目要插入的深度, 仅位置类型为 `'at_depth'` 时有效",
                          "type": "number"
                        },
                        "order": {
                          "type": "number"
                        }
                      },
                      "required": [
                        "type",
                        "order"
                      ],
                      "additionalProperties": false
                    },
                    "probability": {
                      "type": "number",
                      "minimum": 0,
                      "maximum": 100
                    },
                    "recursion": {
                      "description": "递归表示某世界书条目被激活后, 该条目的提示词又激活了其他条目",
                      "type": "object",
                      "properties": {
                        "prevent_incoming": {
                          "description": "禁止其他条目递归激活本条目",
                          "type": "boolean"
                        },
                        "prevent_outgoing": {
                          "description": "禁止本条目递归激活其他条目",
                          "type": "boolean"
                        },
                        "delay_until": {
                          "description": "延迟到第 n 级递归检查时才能激活本条目",
                          "anyOf": [
                            {
                              "type": "number",
                              "minimum": 1
                            },
                            {
                              "type": "null"
                            }
                          ]
                        }
                      },
                      "additionalProperties": false
                    },
                    "effect": {
                      "type": "object",
                      "properties": {
                        "sticky": {
                          "description": "黏性: 条目激活后, 在之后 n 条消息内始终激活, 无视激活策略、激活概率%",
                          "anyOf": [
                            {
                              "type": "number",
                              "minimum": 1
                            },
                            {
                              "type": "null"
                            }
                          ]
                        },
                        "cooldown": {
                          "description": "冷却: 条目激活后, 在之后 n 条消息内不能再激活",
                          "anyOf": [
                            {
                              "type": "number",
                              "minimum": 1
                            },
                            {
                              "type": "null"
                            }
                          ]
                        },
                        "delay": {
                          "description": "延迟: 聊天中至少有 n 楼消息时, 才能激活条目",
                          "anyOf": [
                            {
                              "type": "number",
                              "minimum": 1
                            },
                            {
                              "type": "null"
                            }
                          ]
                        }
                      },
                      "additionalProperties": false
                    },
                    "group": {
                      "description": "包含组",
                      "type": "object",
                      "properties": {
                        "labels": {
                          "description": "组标签",
                          "minItems": 1,
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        },
                        "use_priority": {
                          "description": "使用优先级",
                          "default": false,
                          "type": "boolean"
                        },
                        "weight": {
                          "description": "权重",
                          "default": 100,
                          "type": "number"
                        },
                        "use_scoring": {
                          "description": "使用评分",
                          "default": "same_as_global",
                          "anyOf": [
                            {
                              "type": "boolean"
                            },
                            {
                              "type": "string",
                              "const": "same_as_global"
                            }
                          ]
                        }
                      },
                      "additionalProperties": false
                    },
                    "extra": {
                      "description": "额外字段: 用于为预设提示词绑定额外数据",
                      "type": "object",
                      "propertyNames": {
                        "type": "string"
                      },
                      "additionalProperties": {}
                    },
                    "content": {
                      "description": "内嵌的提示词内容",
                      "type": "string"
                    },
                    "file": {
                      "description": "外链的提示词文件路径",
                      "type": "string"
                    }
                  },
                  "required": [
                    "name",
                    "enabled",
                    "strategy",
                    "position"
                  ],
                  "additionalProperties": false
                }
              }
            },
            "required": [
              "folder",
              "entries"
            ]
          }
        ]
      }
    }
  },
  "required": [
    "entries"
  ],
  "additionalProperties": false
}