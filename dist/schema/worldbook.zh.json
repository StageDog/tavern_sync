{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "type": "object",
  "properties": {
    "锚点": {
      "description": "用于存放 YAML 锚点, 不会被实际使用"
    },
    "条目": {
      "minItems": 1,
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "名称": {
            "type": "string"
          },
          "uid": {
            "description": "该条目的唯一标识符, 如果不设置或有重复则会自动分配一个新的",
            "type": "number"
          },
          "启用": {
            "type": "boolean"
          },
          "激活策略": {
            "description": "激活策略: 条目应该何时激活",
            "type": "object",
            "properties": {
              "类型": {
                "description": "激活策略类型:\n- 蓝灯: 常量🔵 (constant). 只需要满足 \"启用\"、\"激活概率%\" 等别的要求即可.\n- 绿灯: 可选项🟢 (selective). 除了蓝灯条件, 还需要满足 `关键字` 扫描条件\n- 向量化: 向量化🔗 (vectorized). 一般不使用",
                "type": "string",
                "enum": [
                  "蓝灯",
                  "绿灯",
                  "向量化"
                ]
              },
              "关键字": {
                "description": "关键字: 绿灯条目必须在欲扫描文本中扫描到其中任意一个关键字才能激活",
                "minItems": 1,
                "type": "array",
                "items": {
                  "type": "string"
                }
              },
              "次要关键字": {
                "description": "次要关键字: 如果设置了次要关键字, 则条目除了在`关键字`中匹配到任意一个关键字外, 还需要按次要关键字的`逻辑`满足次要关键字的`关键字`",
                "type": "object",
                "properties": {
                  "逻辑": {
                    "description": "次要关键字逻辑:\n- 与任意 (and_any): 次要关键字中任意一个关键字能在欲扫描文本中匹配到\n- 与所有 (and_all): 次要关键字中所有关键字都能在欲扫描文本中匹配到\n- 非所有 (not_all): 次要关键字中至少有一个关键字没能在欲扫描文本中匹配到\n- 非任意 (not_any): 次要关键字中所有关键字都没能欲扫描文本中匹配到",
                    "type": "string",
                    "enum": [
                      "与任意",
                      "与所有",
                      "非所有",
                      "非任意"
                    ]
                  },
                  "关键字": {
                    "minItems": 1,
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  }
                },
                "required": [
                  "逻辑",
                  "关键字"
                ],
                "additionalProperties": false
              },
              "扫描深度": {
                "description": "扫描深度: 1 为仅扫描最后一个楼层, 2 为扫描最后两个楼层, 以此类推",
                "anyOf": [
                  {
                    "type": "string",
                    "const": "与全局设置相同"
                  },
                  {
                    "type": "number",
                    "minimum": 1
                  }
                ]
              }
            },
            "required": [
              "类型"
            ],
            "additionalProperties": false
          },
          "插入位置": {
            "type": "object",
            "properties": {
              "类型": {
                "type": "string",
                "enum": [
                  "角色定义之前",
                  "角色定义之后",
                  "示例消息之前",
                  "示例消息之后",
                  "作者注释之前",
                  "作者注释之后",
                  "指定深度"
                ]
              },
              "角色": {
                "description": "该条目的消息身份, 仅位置类型为`'指定深度'`时有效",
                "type": "string",
                "enum": [
                  "系统",
                  "AI",
                  "用户"
                ]
              },
              "深度": {
                "description": "该条目要插入的深度, 仅位置类型为`'指定深度'`时有效",
                "type": "number"
              },
              "顺序": {
                "type": "number"
              }
            },
            "required": [
              "类型",
              "顺序"
            ],
            "additionalProperties": false
          },
          "激活概率": {
            "type": "number",
            "minimum": 0,
            "maximum": 100
          },
          "递归": {
            "description": "递归表示某世界书条目被激活后, 该条目的提示词又激活了其他条目",
            "type": "object",
            "properties": {
              "不可被其他条目激活": {
                "description": "禁止其他条目递归激活本条目",
                "type": "boolean"
              },
              "不可激活其他条目": {
                "description": "禁止本条目递归激活其他条目",
                "type": "boolean"
              },
              "延迟递归": {
                "description": "延迟到第 n 级递归检查时才能激活本条目",
                "anyOf": [
                  {
                    "type": "number",
                    "minimum": 1
                  },
                  {
                    "type": "null"
                  }
                ]
              }
            },
            "additionalProperties": false
          },
          "特殊效果": {
            "type": "object",
            "properties": {
              "黏性": {
                "description": "黏性: 条目激活后, 在之后 n 条消息内始终激活, 无视激活策略、激活概率%",
                "anyOf": [
                  {
                    "type": "number",
                    "minimum": 1
                  },
                  {
                    "type": "null"
                  }
                ]
              },
              "冷却": {
                "description": "冷却: 条目激活后, 在之后 n 条消息内不能再激活",
                "anyOf": [
                  {
                    "type": "number",
                    "minimum": 1
                  },
                  {
                    "type": "null"
                  }
                ]
              },
              "延迟": {
                "description": "延迟: 聊天中至少有 n 楼消息时, 才能激活条目",
                "anyOf": [
                  {
                    "type": "number",
                    "minimum": 1
                  },
                  {
                    "type": "null"
                  }
                ]
              }
            },
            "additionalProperties": false
          },
          "额外字段": {
            "description": "额外字段: 用于为预设提示词绑定额外数据",
            "type": "object",
            "propertyNames": {
              "type": "string"
            },
            "additionalProperties": {}
          },
          "内容": {
            "description": "内嵌的提示词内容",
            "type": "string"
          },
          "文件": {
            "description": "外链的提示词文件路径",
            "type": "string"
          }
        },
        "required": [
          "名称",
          "启用",
          "激活策略",
          "插入位置"
        ],
        "additionalProperties": false
      }
    }
  },
  "required": [
    "条目"
  ],
  "additionalProperties": false
}