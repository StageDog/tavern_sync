/*! For license information please see script.js.LICENSE.txt */
import*as __WEBPACK_EXTERNAL_MODULE_https_testingcf_jsdelivr_net_npm_compare_versions_esm_4fbc8a69__ from'https://testingcf.jsdelivr.net/npm/compare-versions/+esm';import*as __WEBPACK_EXTERNAL_MODULE_https_testingcf_jsdelivr_net_npm_socket_io_client_esm_9776f867__ from'https://testingcf.jsdelivr.net/npm/socket.io-client/+esm';var __webpack_modules__={'./src/client/index.ts':(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{eval('{__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _client_preset__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @client/preset */ "./src/client/preset.ts");\n/* harmony import */ var _client_worldbook__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @client/worldbook */ "./src/client/worldbook.ts");\n/* harmony import */ var compare_versions__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! compare-versions */ "compare-versions");\n\n\n\n$(async () => {\n    const version = await getTavernHelperVersion();\n    if ((0,compare_versions__WEBPACK_IMPORTED_MODULE_2__.compare)(version, \'3.4.0\', \'<\')) {\n        //   throw new Error(\'酒馆助手版本过低, 不能使用酒馆同步脚本, 请更新至 3.4.0 或更高版本\');\n    }\n    (0,_client_worldbook__WEBPACK_IMPORTED_MODULE_1__.register_worldbook)();\n    (0,_client_preset__WEBPACK_IMPORTED_MODULE_0__.register_preset)();\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvY2xpZW50L2luZGV4LnRzIiwibWFwcGluZ3MiOiI7Ozs7QUFBaUQ7QUFDTTtBQUNaO0FBRTNDLENBQUMsQ0FBQyxLQUFLLElBQUksRUFBRTtJQUNYLE1BQU0sT0FBTyxHQUFHLE1BQU0sc0JBQXNCLEVBQUUsQ0FBQztJQUMvQyxJQUFJLHlEQUFPLENBQUMsT0FBTyxFQUFFLE9BQU8sRUFBRSxHQUFHLENBQUMsRUFBRSxDQUFDO1FBQ25DLCtEQUErRDtJQUNqRSxDQUFDO0lBQ0QscUVBQWtCLEVBQUUsQ0FBQztJQUNyQiwrREFBZSxFQUFFLENBQUM7QUFDcEIsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90YXZlcm5faGVscGVyX3RlbXBsYXRlLy4vc3JjL2NsaWVudC9pbmRleC50cz8iXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcmVnaXN0ZXJfcHJlc2V0IH0gZnJvbSAnQGNsaWVudC9wcmVzZXQnO1xuaW1wb3J0IHsgcmVnaXN0ZXJfd29ybGRib29rIH0gZnJvbSAnQGNsaWVudC93b3JsZGJvb2snO1xuaW1wb3J0IHsgY29tcGFyZSB9IGZyb20gJ2NvbXBhcmUtdmVyc2lvbnMnO1xuXG4kKGFzeW5jICgpID0+IHtcbiAgY29uc3QgdmVyc2lvbiA9IGF3YWl0IGdldFRhdmVybkhlbHBlclZlcnNpb24oKTtcbiAgaWYgKGNvbXBhcmUodmVyc2lvbiwgJzMuNC4wJywgJzwnKSkge1xuICAgIC8vICAgdGhyb3cgbmV3IEVycm9yKCfphZLppobliqnmiYvniYjmnKzov4fkvY4sIOS4jeiDveS9v+eUqOmFkummhuWQjOatpeiEmuacrCwg6K+35pu05paw6IezIDMuNC4wIOaIluabtOmrmOeJiOacrCcpO1xuICB9XG4gIHJlZ2lzdGVyX3dvcmxkYm9vaygpO1xuICByZWdpc3Rlcl9wcmVzZXQoKTtcbn0pO1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/client/index.ts\n\n}')},'./src/client/preset.ts':(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{eval('{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   register_preset: () => (/* binding */ register_preset)\n/* harmony export */ });\n/* harmony import */ var _client_settings__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @client/settings */ "./src/client/settings.ts");\n/* harmony import */ var _client_socket__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @client/socket */ "./src/client/socket.ts");\n\n\nasync function update_preset(name, data) {\n    await createOrReplacePreset(name, data);\n    if (getLoadedPresetName() === name) {\n        console.info(getLoadedPresetName(), name);\n        loadPreset(name);\n    }\n}\nconst update_preset_debounced = _.debounce(update_preset, (0,_client_settings__WEBPACK_IMPORTED_MODULE_0__.get_settings)().delay);\nfunction register_preset() {\n    const socket = (0,_client_socket__WEBPACK_IMPORTED_MODULE_1__.get_socket)();\n    socket.on(\'pull_preset\', (data, callback) => {\n        console.info(`[TavernSync] 收到提取预设 \'${data.name}\' 的请求`);\n        try {\n            const preset = getPreset(getLoadedPresetName() === data.name ? \'in_use\' : data.name);\n            console.info(preset);\n            callback(preset);\n        }\n        catch (err) {\n            const error = err;\n            console.error(`[TavernSync] 提取预设 \'${data.name}\' 失败: ${error}`);\n            callback(error);\n        }\n    });\n    socket.on(\'push_preset\', (data, callback) => {\n        console.info(`[TavernSync] 收到推送预设 \'${data.name}\' 的请求`);\n        update_preset_debounced(data.name, data.data);\n        callback();\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvY2xpZW50L3ByZXNldC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBZ0Q7QUFDSjtBQUU1QyxLQUFLLFVBQVUsYUFBYSxDQUFDLElBQVksRUFBRSxJQUFZO0lBQ3JELE1BQU0scUJBQXFCLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQ3hDLElBQUksbUJBQW1CLEVBQUUsS0FBSyxJQUFJLEVBQUUsQ0FBQztRQUNuQyxPQUFPLENBQUMsSUFBSSxDQUFDLG1CQUFtQixFQUFFLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDMUMsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ25CLENBQUM7QUFDSCxDQUFDO0FBQ0QsTUFBTSx1QkFBdUIsR0FBRyxDQUFDLENBQUMsUUFBUSxDQUFDLGFBQWEsRUFBRSw4REFBWSxFQUFFLENBQUMsS0FBSyxDQUFDLENBQUM7QUFFekUsU0FBUyxlQUFlO0lBQzdCLE1BQU0sTUFBTSxHQUFHLDBEQUFVLEVBQUUsQ0FBQztJQUM1QixNQUFNLENBQUMsRUFBRSxDQUFDLGFBQWEsRUFBRSxDQUFDLElBQXNCLEVBQUUsUUFBd0MsRUFBRSxFQUFFO1FBQzVGLE9BQU8sQ0FBQyxJQUFJLENBQUMsd0JBQXdCLElBQUksQ0FBQyxJQUFJLE9BQU8sQ0FBQyxDQUFDO1FBQ3ZELElBQUksQ0FBQztZQUNILE1BQU0sTUFBTSxHQUFHLFNBQVMsQ0FBQyxtQkFBbUIsRUFBRSxLQUFLLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3JGLE9BQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDckIsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ25CLENBQUM7UUFBQyxPQUFPLEdBQUcsRUFBRSxDQUFDO1lBQ2IsTUFBTSxLQUFLLEdBQUcsR0FBWSxDQUFDO1lBQzNCLE9BQU8sQ0FBQyxLQUFLLENBQUMsc0JBQXNCLElBQUksQ0FBQyxJQUFJLFNBQVMsS0FBSyxFQUFFLENBQUMsQ0FBQztZQUMvRCxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDbEIsQ0FBQztJQUNILENBQUMsQ0FBQyxDQUFDO0lBQ0gsTUFBTSxDQUFDLEVBQUUsQ0FBQyxhQUFhLEVBQUUsQ0FBQyxJQUFvQyxFQUFFLFFBQW9CLEVBQUUsRUFBRTtRQUN0RixPQUFPLENBQUMsSUFBSSxDQUFDLHdCQUF3QixJQUFJLENBQUMsSUFBSSxPQUFPLENBQUMsQ0FBQztRQUN2RCx1QkFBdUIsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUM5QyxRQUFRLEVBQUUsQ0FBQztJQUNiLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyIsInNvdXJjZXMiOlsid2VicGFjazovL3RhdmVybl9oZWxwZXJfdGVtcGxhdGUvLi9zcmMvY2xpZW50L3ByZXNldC50cz8iXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZ2V0X3NldHRpbmdzIH0gZnJvbSAnQGNsaWVudC9zZXR0aW5ncyc7XG5pbXBvcnQgeyBnZXRfc29ja2V0IH0gZnJvbSAnQGNsaWVudC9zb2NrZXQnO1xuXG5hc3luYyBmdW5jdGlvbiB1cGRhdGVfcHJlc2V0KG5hbWU6IHN0cmluZywgZGF0YTogUHJlc2V0KSB7XG4gIGF3YWl0IGNyZWF0ZU9yUmVwbGFjZVByZXNldChuYW1lLCBkYXRhKTtcbiAgaWYgKGdldExvYWRlZFByZXNldE5hbWUoKSA9PT0gbmFtZSkge1xuICAgIGNvbnNvbGUuaW5mbyhnZXRMb2FkZWRQcmVzZXROYW1lKCksIG5hbWUpO1xuICAgIGxvYWRQcmVzZXQobmFtZSk7XG4gIH1cbn1cbmNvbnN0IHVwZGF0ZV9wcmVzZXRfZGVib3VuY2VkID0gXy5kZWJvdW5jZSh1cGRhdGVfcHJlc2V0LCBnZXRfc2V0dGluZ3MoKS5kZWxheSk7XG5cbmV4cG9ydCBmdW5jdGlvbiByZWdpc3Rlcl9wcmVzZXQoKSB7XG4gIGNvbnN0IHNvY2tldCA9IGdldF9zb2NrZXQoKTtcbiAgc29ja2V0Lm9uKCdwdWxsX3ByZXNldCcsIChkYXRhOiB7IG5hbWU6IHN0cmluZyB9LCBjYWxsYmFjazogKGRhdGE6IFByZXNldCB8IEVycm9yKSA9PiB2b2lkKSA9PiB7XG4gICAgY29uc29sZS5pbmZvKGBbVGF2ZXJuU3luY10g5pS25Yiw5o+Q5Y+W6aKE6K6+ICcke2RhdGEubmFtZX0nIOeahOivt+axgmApO1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBwcmVzZXQgPSBnZXRQcmVzZXQoZ2V0TG9hZGVkUHJlc2V0TmFtZSgpID09PSBkYXRhLm5hbWUgPyAnaW5fdXNlJyA6IGRhdGEubmFtZSk7XG4gICAgICBjb25zb2xlLmluZm8ocHJlc2V0KTtcbiAgICAgIGNhbGxiYWNrKHByZXNldCk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBjb25zdCBlcnJvciA9IGVyciBhcyBFcnJvcjtcbiAgICAgIGNvbnNvbGUuZXJyb3IoYFtUYXZlcm5TeW5jXSDmj5Dlj5bpooTorr4gJyR7ZGF0YS5uYW1lfScg5aSx6LSlOiAke2Vycm9yfWApO1xuICAgICAgY2FsbGJhY2soZXJyb3IpO1xuICAgIH1cbiAgfSk7XG4gIHNvY2tldC5vbigncHVzaF9wcmVzZXQnLCAoZGF0YTogeyBuYW1lOiBzdHJpbmc7IGRhdGE6IFByZXNldCB9LCBjYWxsYmFjazogKCkgPT4gdm9pZCkgPT4ge1xuICAgIGNvbnNvbGUuaW5mbyhgW1RhdmVyblN5bmNdIOaUtuWIsOaOqOmAgemihOiuviAnJHtkYXRhLm5hbWV9JyDnmoTor7fmsYJgKTtcbiAgICB1cGRhdGVfcHJlc2V0X2RlYm91bmNlZChkYXRhLm5hbWUsIGRhdGEuZGF0YSk7XG4gICAgY2FsbGJhY2soKTtcbiAgfSk7XG59XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/client/preset.ts\n\n}')},'./src/client/settings.ts':(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{eval('{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   get_settings: () => (/* binding */ get_settings)\n/* harmony export */ });\nconst Settings = z.object({\n    url: z.string().default(\'http://localhost:6620\'),\n    delay: z.number().min(0).default(1000),\n});\nconst variable_option = { type: \'script\', script_id: getScriptId() };\nlet settings;\nfunction get_settings() {\n    if (!settings) {\n        settings = Settings.parse(getVariables(variable_option));\n        insertVariables(settings, variable_option);\n    }\n    return settings;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvY2xpZW50L3NldHRpbmdzLnRzIiwibWFwcGluZ3MiOiI7Ozs7QUFDQSxNQUFNLFFBQVEsR0FBRyxDQUFDLENBQUMsTUFBTSxDQUFDO0lBQ3hCLEdBQUcsRUFBRSxDQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsT0FBTyxDQUFDLHVCQUF1QixDQUFDO0lBQ2hELEtBQUssRUFBRSxDQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUM7Q0FDdkMsQ0FBQyxDQUFDO0FBRUgsTUFBTSxlQUFlLEdBQUcsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBRSxXQUFXLEVBQUUsRUFBVyxDQUFDO0FBRTlFLElBQUksUUFBa0IsQ0FBQztBQUNoQixTQUFTLFlBQVk7SUFDMUIsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQ2QsUUFBUSxHQUFHLFFBQVEsQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUM7UUFDekQsZUFBZSxDQUFDLFFBQVEsRUFBRSxlQUFlLENBQUMsQ0FBQztJQUM3QyxDQUFDO0lBQ0QsT0FBTyxRQUFRLENBQUM7QUFDbEIsQ0FBQyIsInNvdXJjZXMiOlsid2VicGFjazovL3RhdmVybl9oZWxwZXJfdGVtcGxhdGUvLi9zcmMvY2xpZW50L3NldHRpbmdzLnRzPyJdLCJzb3VyY2VzQ29udGVudCI6WyJ0eXBlIFNldHRpbmdzID0gei5pbmZlcjx0eXBlb2YgU2V0dGluZ3M+O1xuY29uc3QgU2V0dGluZ3MgPSB6Lm9iamVjdCh7XG4gIHVybDogei5zdHJpbmcoKS5kZWZhdWx0KCdodHRwOi8vbG9jYWxob3N0OjY2MjAnKSxcbiAgZGVsYXk6IHoubnVtYmVyKCkubWluKDApLmRlZmF1bHQoMTAwMCksXG59KTtcblxuY29uc3QgdmFyaWFibGVfb3B0aW9uID0geyB0eXBlOiAnc2NyaXB0Jywgc2NyaXB0X2lkOiBnZXRTY3JpcHRJZCgpIH0gYXMgY29uc3Q7XG5cbmxldCBzZXR0aW5nczogU2V0dGluZ3M7XG5leHBvcnQgZnVuY3Rpb24gZ2V0X3NldHRpbmdzKCk6IFNldHRpbmdzIHtcbiAgaWYgKCFzZXR0aW5ncykge1xuICAgIHNldHRpbmdzID0gU2V0dGluZ3MucGFyc2UoZ2V0VmFyaWFibGVzKHZhcmlhYmxlX29wdGlvbikpO1xuICAgIGluc2VydFZhcmlhYmxlcyhzZXR0aW5ncywgdmFyaWFibGVfb3B0aW9uKTtcbiAgfVxuICByZXR1cm4gc2V0dGluZ3M7XG59XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/client/settings.ts\n\n}')},'./src/client/socket.ts':(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{eval('{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   get_socket: () => (/* binding */ get_socket)\n/* harmony export */ });\n/* harmony import */ var _client_settings__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @client/settings */ "./src/client/settings.ts");\n/* harmony import */ var socket_io_client__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! socket.io-client */ "socket.io-client");\n\n\nlet socket = null;\nfunction get_socket() {\n    if (!socket) {\n        const settings = (0,_client_settings__WEBPACK_IMPORTED_MODULE_0__.get_settings)();\n        socket = (0,socket_io_client__WEBPACK_IMPORTED_MODULE_1__.io)(settings.url, { retries: 3 });\n        socket.on(\'connect\', () => {\n            console.info(\'[TavernSync] 成功连接至服务器\');\n        });\n        socket.on(\'connect_error\', (error) => {\n            if (socket.active) {\n                console.warn(`[TavernSync] 连接服务器出错, 尝试重连! ${error.stack}`);\n            }\n            else {\n                console.error(`[TavernSync] 连接服务器出错, 请手动连接重试! ${error.stack}`);\n            }\n        });\n        socket.on(\'disconnect\', (reason, details) => {\n            console.info(`[TavernSync] 与服务器断开连接: ${reason}\\n${JSON.stringify(details)}`);\n        });\n    }\n    return socket;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvY2xpZW50L3NvY2tldC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBZ0Q7QUFFRjtBQUU5QyxJQUFJLE1BQU0sR0FBa0IsSUFBSSxDQUFDO0FBQzFCLFNBQVMsVUFBVTtJQUN4QixJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDWixNQUFNLFFBQVEsR0FBRyw4REFBWSxFQUFFLENBQUM7UUFDaEMsTUFBTSxHQUFHLG9EQUFFLENBQUMsUUFBUSxDQUFDLEdBQUcsRUFBRSxFQUFFLE9BQU8sRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBRTFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsU0FBUyxFQUFFLEdBQUcsRUFBRTtZQUN4QixPQUFPLENBQUMsSUFBSSxDQUFDLHVCQUF1QixDQUFDLENBQUM7UUFDeEMsQ0FBQyxDQUFDLENBQUM7UUFDSCxNQUFNLENBQUMsRUFBRSxDQUFDLGVBQWUsRUFBRSxDQUFDLEtBQVksRUFBRSxFQUFFO1lBQzFDLElBQUksTUFBTyxDQUFDLE1BQU0sRUFBRSxDQUFDO2dCQUNuQixPQUFPLENBQUMsSUFBSSxDQUFDLCtCQUErQixLQUFLLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQztZQUM3RCxDQUFDO2lCQUFNLENBQUM7Z0JBQ04sT0FBTyxDQUFDLEtBQUssQ0FBQyxrQ0FBa0MsS0FBSyxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUM7WUFDakUsQ0FBQztRQUNILENBQUMsQ0FBQyxDQUFDO1FBQ0gsTUFBTSxDQUFDLEVBQUUsQ0FBQyxZQUFZLEVBQUUsQ0FBQyxNQUFNLEVBQUUsT0FBTyxFQUFFLEVBQUU7WUFDMUMsT0FBTyxDQUFDLElBQUksQ0FBQywwQkFBMEIsTUFBTSxLQUFLLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQy9FLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUNELE9BQU8sTUFBTSxDQUFDO0FBQ2hCLENBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90YXZlcm5faGVscGVyX3RlbXBsYXRlLy4vc3JjL2NsaWVudC9zb2NrZXQudHM/Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGdldF9zZXR0aW5ncyB9IGZyb20gJ0BjbGllbnQvc2V0dGluZ3MnO1xuXG5pbXBvcnQgeyBpbywgU29ja2V0IH0gZnJvbSAnc29ja2V0LmlvLWNsaWVudCc7XG5cbmxldCBzb2NrZXQ6IFNvY2tldCB8IG51bGwgPSBudWxsO1xuZXhwb3J0IGZ1bmN0aW9uIGdldF9zb2NrZXQoKTogU29ja2V0IHtcbiAgaWYgKCFzb2NrZXQpIHtcbiAgICBjb25zdCBzZXR0aW5ncyA9IGdldF9zZXR0aW5ncygpO1xuICAgIHNvY2tldCA9IGlvKHNldHRpbmdzLnVybCwgeyByZXRyaWVzOiAzIH0pO1xuXG4gICAgc29ja2V0Lm9uKCdjb25uZWN0JywgKCkgPT4ge1xuICAgICAgY29uc29sZS5pbmZvKCdbVGF2ZXJuU3luY10g5oiQ5Yqf6L+e5o6l6Iez5pyN5Yqh5ZmoJyk7XG4gICAgfSk7XG4gICAgc29ja2V0Lm9uKCdjb25uZWN0X2Vycm9yJywgKGVycm9yOiBFcnJvcikgPT4ge1xuICAgICAgaWYgKHNvY2tldCEuYWN0aXZlKSB7XG4gICAgICAgIGNvbnNvbGUud2FybihgW1RhdmVyblN5bmNdIOi/nuaOpeacjeWKoeWZqOWHuumUmSwg5bCd6K+V6YeN6L+eISAke2Vycm9yLnN0YWNrfWApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihgW1RhdmVyblN5bmNdIOi/nuaOpeacjeWKoeWZqOWHuumUmSwg6K+35omL5Yqo6L+e5o6l6YeN6K+VISAke2Vycm9yLnN0YWNrfWApO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHNvY2tldC5vbignZGlzY29ubmVjdCcsIChyZWFzb24sIGRldGFpbHMpID0+IHtcbiAgICAgIGNvbnNvbGUuaW5mbyhgW1RhdmVyblN5bmNdIOS4juacjeWKoeWZqOaWreW8gOi/nuaOpTogJHtyZWFzb259XFxuJHtKU09OLnN0cmluZ2lmeShkZXRhaWxzKX1gKTtcbiAgICB9KTtcbiAgfVxuICByZXR1cm4gc29ja2V0O1xufVxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/client/socket.ts\n\n}')},'./src/client/worldbook.ts':(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{eval('{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   register_worldbook: () => (/* binding */ register_worldbook)\n/* harmony export */ });\n/* harmony import */ var _client_settings__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @client/settings */ "./src/client/settings.ts");\n/* harmony import */ var _client_socket__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @client/socket */ "./src/client/socket.ts");\n\n\nasync function update_worldbook(name, data) {\n    await createOrReplaceWorldbook(name, data);\n}\nconst update_worldbook_debounced = _.debounce(update_worldbook, (0,_client_settings__WEBPACK_IMPORTED_MODULE_0__.get_settings)().delay);\nfunction register_worldbook() {\n    const socket = (0,_client_socket__WEBPACK_IMPORTED_MODULE_1__.get_socket)();\n    socket.on(\'pull_worldbook\', async (data, callback) => {\n        console.info(`[TavernSync] 收到提取世界书 \'${data.name}\' 的请求`);\n        try {\n            callback(await getWorldbook(data.name));\n        }\n        catch (err) {\n            const error = err;\n            console.error(`[TavernSync] 提取世界书 \'${data.name}\' 失败: ${error}`);\n            callback(error);\n        }\n    });\n    socket.on(\'push_worldbook\', (data, callback) => {\n        console.info(`[TavernSync] 收到推送世界书 \'${data.name}\' 的请求`);\n        update_worldbook_debounced(data.name, data.data);\n        callback();\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvY2xpZW50L3dvcmxkYm9vay50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBZ0Q7QUFDSjtBQUk1QyxLQUFLLFVBQVUsZ0JBQWdCLENBQUMsSUFBWSxFQUFFLElBQW1DO0lBQy9FLE1BQU0sd0JBQXdCLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO0FBQzdDLENBQUM7QUFDRCxNQUFNLDBCQUEwQixHQUFHLENBQUMsQ0FBQyxRQUFRLENBQUMsZ0JBQWdCLEVBQUUsOERBQVksRUFBRSxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBRS9FLFNBQVMsa0JBQWtCO0lBQ2hDLE1BQU0sTUFBTSxHQUFHLDBEQUFVLEVBQUUsQ0FBQztJQUM1QixNQUFNLENBQUMsRUFBRSxDQUFDLGdCQUFnQixFQUFFLEtBQUssRUFBRSxJQUFzQixFQUFFLFFBQWtELEVBQUUsRUFBRTtRQUMvRyxPQUFPLENBQUMsSUFBSSxDQUFDLHlCQUF5QixJQUFJLENBQUMsSUFBSSxPQUFPLENBQUMsQ0FBQztRQUN4RCxJQUFJLENBQUM7WUFDSCxRQUFRLENBQUMsTUFBTSxZQUFZLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDMUMsQ0FBQztRQUFDLE9BQU8sR0FBRyxFQUFFLENBQUM7WUFDYixNQUFNLEtBQUssR0FBRyxHQUFZLENBQUM7WUFDM0IsT0FBTyxDQUFDLEtBQUssQ0FBQyx1QkFBdUIsSUFBSSxDQUFDLElBQUksU0FBUyxLQUFLLEVBQUUsQ0FBQyxDQUFDO1lBQ2hFLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNsQixDQUFDO0lBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDSCxNQUFNLENBQUMsRUFBRSxDQUFDLGdCQUFnQixFQUFFLENBQUMsSUFBMkQsRUFBRSxRQUFvQixFQUFFLEVBQUU7UUFDaEgsT0FBTyxDQUFDLElBQUksQ0FBQyx5QkFBeUIsSUFBSSxDQUFDLElBQUksT0FBTyxDQUFDLENBQUM7UUFDeEQsMEJBQTBCLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDakQsUUFBUSxFQUFFLENBQUM7SUFDYixDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90YXZlcm5faGVscGVyX3RlbXBsYXRlLy4vc3JjL2NsaWVudC93b3JsZGJvb2sudHM/Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGdldF9zZXR0aW5ncyB9IGZyb20gJ0BjbGllbnQvc2V0dGluZ3MnO1xuaW1wb3J0IHsgZ2V0X3NvY2tldCB9IGZyb20gJ0BjbGllbnQvc29ja2V0JztcblxuaW1wb3J0IHsgUGFydGlhbERlZXAgfSBmcm9tICd0eXBlLWZlc3QnO1xuXG5hc3luYyBmdW5jdGlvbiB1cGRhdGVfd29ybGRib29rKG5hbWU6IHN0cmluZywgZGF0YTogUGFydGlhbERlZXA8V29ybGRib29rRW50cnk+W10pIHtcbiAgYXdhaXQgY3JlYXRlT3JSZXBsYWNlV29ybGRib29rKG5hbWUsIGRhdGEpO1xufVxuY29uc3QgdXBkYXRlX3dvcmxkYm9va19kZWJvdW5jZWQgPSBfLmRlYm91bmNlKHVwZGF0ZV93b3JsZGJvb2ssIGdldF9zZXR0aW5ncygpLmRlbGF5KTtcblxuZXhwb3J0IGZ1bmN0aW9uIHJlZ2lzdGVyX3dvcmxkYm9vaygpIHtcbiAgY29uc3Qgc29ja2V0ID0gZ2V0X3NvY2tldCgpO1xuICBzb2NrZXQub24oJ3B1bGxfd29ybGRib29rJywgYXN5bmMgKGRhdGE6IHsgbmFtZTogc3RyaW5nIH0sIGNhbGxiYWNrOiAoZGF0YTogV29ybGRib29rRW50cnlbXSB8IEVycm9yKSA9PiB2b2lkKSA9PiB7XG4gICAgY29uc29sZS5pbmZvKGBbVGF2ZXJuU3luY10g5pS25Yiw5o+Q5Y+W5LiW55WM5LmmICcke2RhdGEubmFtZX0nIOeahOivt+axgmApO1xuICAgIHRyeSB7XG4gICAgICBjYWxsYmFjayhhd2FpdCBnZXRXb3JsZGJvb2soZGF0YS5uYW1lKSk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBjb25zdCBlcnJvciA9IGVyciBhcyBFcnJvcjtcbiAgICAgIGNvbnNvbGUuZXJyb3IoYFtUYXZlcm5TeW5jXSDmj5Dlj5bkuJbnlYzkuaYgJyR7ZGF0YS5uYW1lfScg5aSx6LSlOiAke2Vycm9yfWApO1xuICAgICAgY2FsbGJhY2soZXJyb3IpO1xuICAgIH1cbiAgfSk7XG4gIHNvY2tldC5vbigncHVzaF93b3JsZGJvb2snLCAoZGF0YTogeyBuYW1lOiBzdHJpbmc7IGRhdGE6IFBhcnRpYWxEZWVwPFdvcmxkYm9va0VudHJ5PltdIH0sIGNhbGxiYWNrOiAoKSA9PiB2b2lkKSA9PiB7XG4gICAgY29uc29sZS5pbmZvKGBbVGF2ZXJuU3luY10g5pS25Yiw5o6o6YCB5LiW55WM5LmmICcke2RhdGEubmFtZX0nIOeahOivt+axgmApO1xuICAgIHVwZGF0ZV93b3JsZGJvb2tfZGVib3VuY2VkKGRhdGEubmFtZSwgZGF0YS5kYXRhKTtcbiAgICBjYWxsYmFjaygpO1xuICB9KTtcbn1cbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/client/worldbook.ts\n\n}')},'compare-versions':Q=>{Q.exports=__WEBPACK_EXTERNAL_MODULE_https_testingcf_jsdelivr_net_npm_compare_versions_esm_4fbc8a69__},'socket.io-client':Q=>{Q.exports=__WEBPACK_EXTERNAL_MODULE_https_testingcf_jsdelivr_net_npm_socket_io_client_esm_9776f867__}},__webpack_module_cache__={};function __webpack_require__(Q){var e=__webpack_module_cache__[Q];if(void 0!==e)return e.exports;var U=__webpack_module_cache__[Q]={exports:{}};return __webpack_modules__[Q](U,U.exports,__webpack_require__),U.exports}__webpack_require__.d=(Q,e)=>{for(var U in e)__webpack_require__.o(e,U)&&!__webpack_require__.o(Q,U)&&Object.defineProperty(Q,U,{enumerable:!0,get:e[U]})},__webpack_require__.o=(Q,e)=>Object.prototype.hasOwnProperty.call(Q,e),__webpack_require__.r=Q=>{'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(Q,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(Q,'__esModule',{value:!0})};var __webpack_exports__=__webpack_require__('./src/client/index.ts');